plugins {
    id 'war'
    id 'org.gretty' version '2.2.0'
    id 'org.hidetake.ssh' version '2.10.1'
}

repositories {
    jcenter()
}

dependencies {
    providedCompile 'javax.servlet:javax.servlet-api:3.1.0' 
    testCompile 'junit:junit:4.12'
}

task deployToTomcat(type: Copy) {
    from war.archivePath
    into "/var/lib/tomcat9/webapps"
}

remotes {
  webServer {
    host = '192.168.0.13'
    user = project.properties.user
    password = project.properties.password
  }
}

task deploy {
  doLast {
    ssh.run {
      session(remotes.webServer) {
        put from: war.archivePath, into: '/home/pi'
        execute 'sudo mv /home/pi/java-web-app.war /var/lib/tomcat9/webapps'
      }
    }
  }
}